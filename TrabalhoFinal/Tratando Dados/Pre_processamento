# -*- coding: utf-8 -*-
"""Pre_Pro.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1S0MImbQR0WTfEt49pJquEeDuq3B4HJ-a
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

pd.set_option('display.max_columns', None)

from sklearn.feature_selection import SelectKBest
from sklearn.feature_selection import chi2
from sklearn.feature_selection import RFE
from sklearn.linear_model import LogisticRegression
from sklearn.preprocessing import LabelEncoder
from sklearn.model_selection import train_test_split
from sklearn.preprocessing import StandardScaler
from sklearn.linear_model import LogisticRegression
from sklearn.utils import class_weight
from sklearn.metrics import roc_curve, roc_auc_score, precision_score, accuracy_score,confusion_matrix

df = pd.read_csv('/content/dataframe.csv', sep = ',')

len(df)

df.head(3)

# Unidade da federação - V0001
# Tipo de situação censitária: Urbano, rural - V0026
# Sexo - C006
# Idade do morador na data de referência - C008
# Cor ou raça - C009
# Sabe ler e escrever - D001
# Qual foi o curso mais elevado que ___frequentou  - D00901 
# Quando o(a) Sr(a) sobe uma ladeira, um lance de escadas ou caminha rápido no plano, sente dor ou desconforto no peito - N004
# Quando o(a) Sr(a) caminha em lugar plano, em velocidade normal, sente dor ou desconforto no peito - N005
# Nas duas últimas semanas, com que frequência o(a) Sr(a) teve problemas no sono, como dificuldade para adormecer, acordar frequentemente à noite ou dormir mais do que de costume? - N010
# Nas duas últimas semanas, com que frequência o(a) Sr(a) teve problemas por não se sentir descansado(a) e disposto(a) durante o dia, sentindo-se cansado(a), sem ter energia? - N011
# "Peso - Final (em kg) (3 inteiros e 1 casa decimal)" - P00104
# "Altura - Final (em cm) (3 inteiros)" - P00404
#'Em geral, o(a) Sr(a) costuma comer esse tipo de verdura ou legume - P01001'
# Em geral, quantas vezes por dia o(a) Sr(a) come frutas? - P019
# Em quantos dias da semana o(a) Sr(a) costuma tomar refrigerante? - P02002
# Que tipo de refrigerante o(a) Sr(a) costuma tomar? - P02102
# Nos últimos três meses, o(a) Sr(a) praticou algum tipo de exercício físico ou esporte? - P034
# Quantos dias por semana o(a) Sr(a) costuma  (costumava)praticar exercício físico ou esporte? - P035
# No seu trabalho, o(a) Sr(a) anda bastante a pé?  - P038
# No seu trabalho, o(a) Sr(a) faz faxina pesada, carrega peso ou faz outra atividade pesada que requer esforço físico intenso? - P039
# Em um dia normal, quanto tempo o(a) Sr(a) passa andando bastante a pé ou realizando essas atividades pesadas ou que requerem esforço físico no seu trabalho?Horas - P03905
# Para ir ou voltar do trabalho, o(a) Sr(a) faz algum trajeto a pé ou de bicicleta? - P040
# Atualmente, o(a) Sr(a) fuma algum produto do tabaco? -- P50
# E no passado, o(a) Sr(a) fumou algum produto do tabaco diariamente? -- P051
# Em média, quanto fuma por dia ou por semana Cigarros industrializados -- P05401
# Quantos  por dia?  P05402
# Algum médico já lhe deu o diagnóstico de hipertensão arterial (pressão alta)? -- Q00201
# Algum médico já lhe deu o diagnóstico de diabetes? -- Q03001
# Algum médico já lhe deu o diagnóstico de colesterol alto? -- Q060
# Algum médico já lhe deu o diagnóstico de uma doença do coração, tal como infarto, angina, insuficiência cardíaca ou outra? -- Q06306
# Algum médico já lhe deu o diagnóstico de AVC (Acidente Vascular Cerebral) ou derrame? -- Q068
# Algum médico já lhe deu o diagnóstico de insuficiência renal crônica? -- Q124

colunas = ['Estado', 'situação censitária', 'Sexo', 'Idade','Cor','Sabe Ler?','Escolaridade', 'Sente dor no peito em ladeiras/escada?',
'Sente dor no peito em lugares planos?', 'Problemas do sono', 'cansaço', 'Peso', 'Altura','Come legumes?','Come Frutas?','Toma refri(Freq)?','Que tipo de refri?', 'Pratica esporte?',
'Quantos dias na semana pratica esporte?', 'Anda no trabalho?', 'O trabalho é pesado fisicamente?', 'Tempo realizando atv fisica no trabalho', 'Vai de bike ou a pé para o trabalho?',
'Fuma tabaco?', 'Fumou mes passado diariamente?', 'Fuma qts cigarros por dia em media', 'Fuma quantos por dia','Hipertenso', 'Diabetes','Colesterol Alto', 'Doença do coracao',
'AVC', 'Insuficiencia Renal']

df = df.rename(columns=dict(zip(df.columns, colunas)))

df.head()

# Dicionário de mapeamento dos estados para as regiões
regioes = {
    'Acre': 'Norte','Alagoas': 'Nordeste','Amapá': 'Norte','Amazonas': 'Norte','Bahia': 'Nordeste','Ceará': 'Nordeste','Distrito Federal': 'Centro-Oeste','Espírito Santo': 'Sudeste','Goiás': 'Centro-Oeste','Maranhão': 'Nordeste',
    'Mato Grosso': 'Centro-Oeste','Mato Grosso do Sul': 'Centro-Oeste','Minas Gerais': 'Sudeste','Pará': 'Norte','Paraíba': 'Nordeste','Paraná': 'Sul','Pernambuco': 'Nordeste','Piauí': 'Nordeste',
    'Rio de Janeiro': 'Sudeste','Rio Grande do Norte': 'Nordeste','Rio Grande do Sul': 'Sul','Rondônia': 'Norte','Roraima': 'Norte','Santa Catarina': 'Sul','São Paulo': 'Sudeste','Sergipe': 'Nordeste',
    'Tocantins': 'Norte'
}


# Função para mapear o estado para a região
def obter_regiao(estado):
    return regioes.get(estado)

# Cria a nova coluna 'Região' aplicando a função de mapeamento
df['Região'] = df['Estado'].map(obter_regiao)

df.head(2)

# Criando o IMC
df['Altura'] = df['Altura']/100

df['IMC'] = df['Peso'] / (df['Altura'] ** 2)

df.head(2)

# Removendo os NA do nosso rotulo se tem hipertensao
df = df.dropna(subset=['Hipertenso'])
df.head(2)

df.isna().sum().sort_values(ascending=False)

# Preenchendo o NA por -99 
df = df.fillna(-99)

for coluna in df.columns:
    # Converte a coluna em uma variável categórica com valores numéricos
    df[coluna] = pd.Categorical(df[coluna]).codes

df.head(3)

X = df.drop('Hipertenso', axis=1)
y = df['Hipertenso']



X = df.drop('Hipertenso', axis=1)
y = df['Hipertenso']

# Crie um modelo de regressão logística
model = LogisticRegression()

# Selecione as melhores variáveis usando RFE
rfe = RFE(estimator=model, n_features_to_select=5)
fit = rfe.fit(X, y)

# Exiba as variáveis selecionadas
selected_features = pd.DataFrame({'Variavel': X.columns, 'Selecionada': fit.support_})
selected_features = selected_features[selected_features['Selecionada']].reset_index(drop=True)
print(selected_features)

X = df[['Sabe Ler?']]
y= df['Hipertenso']

X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)

model = LogisticRegression()
model.fit(X, y)

predictions = model.predict(X)
accuracy = accuracy_score(y, predictions)
print("Acurácia:", accuracy)
